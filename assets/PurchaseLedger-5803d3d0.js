import{q as S,r as v,o as me,b as c,v as fe,d as h,e as x,f as e,w as t,g as d,E as $,k as n,F as B,h as G,j as H,x as _e,i as C,t as i,l as ve,s as he,m as ge,A as be,C as Ne}from"./index-8e7c3932.js";import{_ as ye}from"./plugin-vueexport-helper-c27b6911.js";import{X as we,$ as Ce,a0 as Te,a1 as Ve,a2 as ke,a3 as xe,a4 as qe,a5 as De,Y}from"./installCanvasRenderer-9ad989bc.js";const Fe={class:"purchase-ledger-container"},Pe={class:"card-content"},Se={class:"card-info"},$e={class:"card-title"},ze={class:"card-value"},Ae={class:"table-toolbar"},Ie={class:"pagination-container"},Ee={class:"card-header"},Le={key:1},Ue={__name:"PurchaseLedger",setup(Re){we([Ce,Te,Ve,ke,xe,qe,De]);const X=[{value:"pending",label:"待审核"},{value:"approved",label:"待验收"},{value:"completed",label:"已完成"},{value:"rejected",label:"驳回"}],z=s=>{switch(s){case"pending":return"warning";case"approved":return"primary";case"completed":return"success";case"rejected":return"danger";default:return"info"}},A=s=>{const a=X.find(f=>f.value===s);return a?a.label:s},b=s=>`¥ ${Number(s).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,r=S({contractNo:"",purchaseNo:"",purchaseTimeRange:[],equipmentName:""}),W=()=>{r.contractNo="",r.purchaseNo="",r.purchaseTimeRange=[],r.equipmentName="",I()},I=()=>{N.value=1,T()},J=S([{title:"采购总金额",value:"¥ 2,950,000.00",icon:"Money",color:"#409EFF"},{title:"采购总数量",value:"11",icon:"ShoppingCart",color:"#67C23A"},{title:"待验收",value:"2",icon:"Document",color:"#E6A23C"},{title:"已完成",value:"8",icon:"CircleCheck",color:"#67C23A"}]),q=v(!1),E=v([]),N=v(1),y=v(10),L=v(0),T=()=>{q.value=!0,setTimeout(()=>{let a=[...[{id:1,contractNo:"HT20230001",purchaseNo:"CG20230001",purchaseTime:"2023-06-15",equipmentName:"CT扫描仪",equipmentId:1,warehouseName:"医疗设备仓库",warehouseId:1,departmentName:"放射科",departmentId:1,quantity:1,amount:15e5,model:"CT-X100",purchaser:"张三",status:"completed",invoiceVerified:!0,acceptanceTime:"2023-07-01 10:30:00",acceptancePerson:"李四",specificationFile:"spec1.pdf",invoiceNo:"FP20230001",invoiceAmount:15e5,invoiceDate:"2023-06-20",verifier:"王五",remark:"高端CT设备采购"},{id:2,contractNo:"HT20230002",purchaseNo:"CG20230002",purchaseTime:"2023-06-20",equipmentName:"呼吸机",equipmentId:2,warehouseName:"医疗设备仓库",warehouseId:1,departmentName:"重症医学科",departmentId:2,quantity:5,amount:5e5,model:"HX-2000",purchaser:"李四",status:"approved",invoiceVerified:!1,acceptanceTime:"",acceptancePerson:"",specificationFile:"spec2.pdf",remark:"重症科室呼吸机更新"},{id:3,contractNo:"HT20230003",purchaseNo:"CG20230003",purchaseTime:"2023-07-05",equipmentName:"心电图机",equipmentId:3,warehouseName:"医疗设备仓库",warehouseId:1,departmentName:"心内科",departmentId:3,quantity:3,amount:15e4,model:"ECG-300",purchaser:"王五",status:"completed",invoiceVerified:!0,acceptanceTime:"2023-07-20 14:30:00",acceptancePerson:"赵六",specificationFile:"spec3.pdf",invoiceNo:"FP20230003",invoiceAmount:15e4,invoiceDate:"2023-07-10",verifier:"张三",remark:"心内科常规设备更新"},{id:4,contractNo:"HT20230004",purchaseNo:"CG20230004",purchaseTime:"2023-07-10",equipmentName:"超声波仪",equipmentId:4,warehouseName:"医疗设备仓库",warehouseId:1,departmentName:"妇产科",departmentId:4,quantity:2,amount:8e5,model:"US-500",purchaser:"赵六",status:"completed",invoiceVerified:!0,acceptanceTime:"2023-07-25 09:30:00",acceptancePerson:"张三",specificationFile:"spec4.pdf",invoiceNo:"FP20230004",invoiceAmount:8e5,invoiceDate:"2023-07-15",verifier:"李四",remark:"妇产科超声波设备更新"}]];if(r.contractNo&&(a=a.filter(_=>_.contractNo.includes(r.contractNo))),r.purchaseNo&&(a=a.filter(_=>_.purchaseNo.includes(r.purchaseNo))),r.purchaseTimeRange&&r.purchaseTimeRange.length===2){const _=r.purchaseTimeRange[0],g=r.purchaseTimeRange[1];a=a.filter(V=>V.purchaseTime>=_&&V.purchaseTime<=g)}r.equipmentName&&(a=a.filter(_=>_.equipmentName.includes(r.equipmentName))),L.value=a.length;const f=(N.value-1)*y.value,p=f+y.value;E.value=a.slice(f,p),q.value=!1},500)},K=s=>{y.value=s,T()},Q=s=>{N.value=s,T()},D=v(!1),o=S({id:null,contractNo:"",purchaseNo:"",purchaseTime:"",equipmentName:"",warehouseName:"",departmentName:"",quantity:0,amount:0,model:"",purchaser:"",status:"",invoiceVerified:!1,acceptanceTime:"",acceptancePerson:"",specificationFile:null,invoiceNo:"",invoiceAmount:0,invoiceDate:"",verifier:"",remark:""}),Z=s=>{Object.assign(o,s),D.value=!0},ee=s=>{$.info("查看规格文件："+s.specificationFile)},te=()=>{$.success("导出成功")},ae=()=>{$.success("打印成功")},U=v(null),R=v(null),M=v("2023"),le=[{value:"2023",label:"2023年"},{value:"2022",label:"2022年"},{value:"2021",label:"2021年"}],oe=()=>{const s=U.value,a=Y(s),f={title:{text:"月度采购金额统计",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(p){const _=p[0];return`${_.name}月: ${b(_.value)}`}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},yAxis:{type:"value",axisLabel:{formatter:function(p){return p/1e4+"万"}}},series:[{name:"采购金额",type:"bar",barWidth:"60%",data:[15e4,23e4,18e4,32e4,25e4,35e4,45e4,28e4,32e4,19e4,23e4,2e5],itemStyle:{color:"#409EFF"}}]};a.setOption(f),window.addEventListener("resize",function(){a.resize()})},ne=()=>{const s=R.value,a=Y(s),f={title:{text:"设备分类采购占比",left:"center"},tooltip:{trigger:"item",formatter:function(p){return`${p.name}: ${b(p.value)} (${p.percent}%)`}},legend:{orient:"vertical",left:"left"},series:[{name:"采购金额",type:"pie",radius:"50%",data:[{value:15e5,name:"影像设备"},{value:5e5,name:"生命支持设备"},{value:15e4,name:"诊断设备"},{value:8e5,name:"治疗设备"}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};a.setOption(f),window.addEventListener("resize",function(){a.resize()})};return me(()=>{T(),setTimeout(()=>{oe(),ne()},500)}),(s,a)=>{const f=c("el-input"),p=c("el-form-item"),_=c("el-date-picker"),g=c("el-button"),V=c("el-form"),w=c("el-card"),F=c("el-icon"),P=c("el-col"),O=c("el-row"),m=c("el-table-column"),k=c("el-tag"),ie=c("el-table"),re=c("el-pagination"),se=c("el-option"),ce=c("el-select"),u=c("el-descriptions-item"),ue=c("el-descriptions"),de=c("el-dialog"),pe=fe("loading");return h(),x("div",Fe,[e(w,{class:"search-card"},{default:t(()=>[e(V,{inline:!0,model:r,class:"search-form"},{default:t(()=>[e(p,{label:"合同编号"},{default:t(()=>[e(f,{modelValue:r.contractNo,"onUpdate:modelValue":a[0]||(a[0]=l=>r.contractNo=l),placeholder:"请输入合同编号",clearable:""},null,8,["modelValue"])]),_:1}),e(p,{label:"采购编号"},{default:t(()=>[e(f,{modelValue:r.purchaseNo,"onUpdate:modelValue":a[1]||(a[1]=l=>r.purchaseNo=l),placeholder:"请输入采购编号",clearable:""},null,8,["modelValue"])]),_:1}),e(p,{label:"采购时间"},{default:t(()=>[e(_,{modelValue:r.purchaseTimeRange,"onUpdate:modelValue":a[2]||(a[2]=l=>r.purchaseTimeRange=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(p,{label:"设备名称"},{default:t(()=>[e(f,{modelValue:r.equipmentName,"onUpdate:modelValue":a[3]||(a[3]=l=>r.equipmentName=l),placeholder:"请输入设备名称",clearable:""},null,8,["modelValue"])]),_:1}),e(p,null,{default:t(()=>[e(g,{type:"primary",onClick:I},{default:t(()=>a[9]||(a[9]=[n("搜索")])),_:1}),e(g,{onClick:W},{default:t(()=>a[10]||(a[10]=[n("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(O,{gutter:20,class:"statistics-row"},{default:t(()=>[(h(!0),x(B,null,G(J,(l,j)=>(h(),C(P,{xs:24,sm:12,md:12,lg:6,xl:6,key:j},{default:t(()=>[e(w,{class:"statistics-card","body-style":{padding:"20px"}},{default:t(()=>[d("div",Pe,[d("div",{class:"card-icon",style:he({backgroundColor:l.color})},[e(F,null,{default:t(()=>[(h(),C(ge(l.icon)))]),_:2},1024)],4),d("div",Se,[d("div",$e,i(l.title),1),d("div",ze,i(l.value),1)])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),d("div",Ae,[e(g,{type:"success",onClick:te},{default:t(()=>[e(F,null,{default:t(()=>[e(H(be))]),_:1}),a[11]||(a[11]=n("导出台账 "))]),_:1}),e(g,{type:"primary",onClick:ae},{default:t(()=>[e(F,null,{default:t(()=>[e(H(Ne))]),_:1}),a[12]||(a[12]=n("打印台账 "))]),_:1})]),e(w,{class:"table-card"},{default:t(()=>[_e((h(),C(ie,{data:E.value,border:"",style:{width:"100%"}},{default:t(()=>[e(m,{prop:"contractNo",label:"合同编号",width:"120"}),e(m,{prop:"purchaseNo",label:"采购编号",width:"120"}),e(m,{prop:"purchaseTime",label:"采购时间",width:"120"}),e(m,{prop:"equipmentName",label:"采购设备",width:"150"}),e(m,{prop:"warehouseName",label:"仓库",width:"100"}),e(m,{prop:"departmentName",label:"科室",width:"100"}),e(m,{prop:"quantity",label:"采购数量",width:"100"}),e(m,{prop:"amount",label:"采购金额",width:"120"},{default:t(l=>[n(i(b(l.row.amount)),1)]),_:1}),e(m,{prop:"model",label:"设备型号",width:"120"}),e(m,{prop:"purchaser",label:"采购人",width:"100"}),e(m,{prop:"status",label:"状态",width:"100"},{default:t(l=>[e(k,{type:z(l.row.status)},{default:t(()=>[n(i(A(l.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"invoiceVerified",label:"发票核验",width:"100"},{default:t(l=>[e(k,{type:l.row.invoiceVerified?"success":"info"},{default:t(()=>[n(i(l.row.invoiceVerified?"已核验":"未核验"),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"acceptanceTime",label:"验收时间",width:"150"}),e(m,{prop:"acceptancePerson",label:"验收人",width:"100"}),e(m,{label:"操作",fixed:"right",width:"120"},{default:t(l=>[e(g,{type:"primary",link:"",onClick:j=>Z(l.row)},{default:t(()=>a[13]||(a[13]=[n(" 查看详情 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[pe,q.value]]),d("div",Ie,[e(re,{"current-page":N.value,"onUpdate:currentPage":a[4]||(a[4]=l=>N.value=l),"page-size":y.value,"onUpdate:pageSize":a[5]||(a[5]=l=>y.value=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:L.value,onSizeChange:K,onCurrentChange:Q},null,8,["current-page","page-size","total"])])]),_:1}),e(O,{gutter:20,class:"chart-row"},{default:t(()=>[e(P,{xs:24,sm:24,md:12,lg:12,xl:12},{default:t(()=>[e(w,{class:"chart-card"},{header:t(()=>[d("div",Ee,[a[14]||(a[14]=d("span",null,"月度采购金额统计",-1)),e(ce,{modelValue:M.value,"onUpdate:modelValue":a[6]||(a[6]=l=>M.value=l),placeholder:"选择年份",style:{width:"120px"}},{default:t(()=>[(h(),x(B,null,G(le,l=>e(se,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])]),default:t(()=>[d("div",{class:"chart-container",ref_key:"monthlyAmountChart",ref:U},null,512)]),_:1})]),_:1}),e(P,{xs:24,sm:24,md:12,lg:12,xl:12},{default:t(()=>[e(w,{class:"chart-card"},{header:t(()=>a[15]||(a[15]=[d("div",{class:"card-header"},[d("span",null,"设备分类采购占比")],-1)])),default:t(()=>[d("div",{class:"chart-container",ref_key:"categoryPieChart",ref:R},null,512)]),_:1})]),_:1})]),_:1}),e(de,{title:"采购详情",modelValue:D.value,"onUpdate:modelValue":a[8]||(a[8]=l=>D.value=l),width:"700px"},{default:t(()=>[e(ue,{column:2,border:""},{default:t(()=>[e(u,{label:"合同编号"},{default:t(()=>[n(i(o.contractNo),1)]),_:1}),e(u,{label:"采购编号"},{default:t(()=>[n(i(o.purchaseNo),1)]),_:1}),e(u,{label:"采购时间"},{default:t(()=>[n(i(o.purchaseTime),1)]),_:1}),e(u,{label:"采购设备"},{default:t(()=>[n(i(o.equipmentName),1)]),_:1}),e(u,{label:"仓库"},{default:t(()=>[n(i(o.warehouseName),1)]),_:1}),e(u,{label:"科室"},{default:t(()=>[n(i(o.departmentName),1)]),_:1}),e(u,{label:"采购数量"},{default:t(()=>[n(i(o.quantity),1)]),_:1}),e(u,{label:"采购金额"},{default:t(()=>[n(i(b(o.amount)),1)]),_:1}),e(u,{label:"设备型号"},{default:t(()=>[n(i(o.model),1)]),_:1}),e(u,{label:"采购人"},{default:t(()=>[n(i(o.purchaser),1)]),_:1}),e(u,{label:"状态"},{default:t(()=>[e(k,{type:z(o.status)},{default:t(()=>[n(i(A(o.status)),1)]),_:1},8,["type"])]),_:1}),e(u,{label:"发票核验"},{default:t(()=>[e(k,{type:o.invoiceVerified?"success":"info"},{default:t(()=>[n(i(o.invoiceVerified?"已核验":"未核验"),1)]),_:1},8,["type"])]),_:1}),e(u,{label:"验收时间"},{default:t(()=>[n(i(o.acceptanceTime||"暂无"),1)]),_:1}),e(u,{label:"验收人"},{default:t(()=>[n(i(o.acceptancePerson||"暂无"),1)]),_:1}),e(u,{label:"规格文件",span:2},{default:t(()=>[o.specificationFile?(h(),C(g,{key:0,type:"primary",link:"",onClick:a[7]||(a[7]=l=>ee(o))},{default:t(()=>a[16]||(a[16]=[n(" 查看 ")])),_:1})):(h(),x("span",Le,"未上传"))]),_:1}),o.invoiceVerified?(h(),C(u,{key:0,label:"发票信息",span:2},{default:t(()=>[d("div",null,"发票号码："+i(o.invoiceNo),1),d("div",null,"发票金额："+i(b(o.invoiceAmount)),1),d("div",null,"开票日期："+i(o.invoiceDate),1),d("div",null,"核验人："+i(o.verifier),1)]),_:1})):ve("",!0),e(u,{label:"备注",span:2},{default:t(()=>[n(i(o.remark||"暂无"),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Be=ye(Ue,[["__scopeId","data-v-dec77198"]]);export{Be as default};
